name: Update ElasticSearch Instance

on:
  # schedule:
  #   - cron: "0 */2 * * *"  # every 2 hours (for now)
  # TODO: switch to cron job
  push:
    branches:
      - try-artifacts-with-github-actions

jobs:
  download_data:
    name: Download and store data from IATI.cloud
    runs-on: ubuntu-latest
    steps:
      - shell: bash
        run: curl https://iati.cloud/search/activity\?q\=\*:\*\&fl\=id,iati_identifier,description_\*,reporting_org_\*,participating_org_\*,title_\*\&wt\=csv\&rows\=5000000  > test_data.csv
      - name: Upload
        uses: actions/upload-artifact@v1
        with:
          name: the_data_from_iati
          path: test_data.csv
  get_number_of_lines:
    name: Get Number of lines of data
    needs: download_data
    runs-on: ubuntu-latest
    steps:
      - name: Get the Artifact
        uses: actions/download-artifact@v1
        with:
          name: the_data_from_iati
      - shell: bash
        run: |
          ls .
          wc -l test_data.csv
