name: Update ElasticSearch Instance

on:
  # schedule:
  #   - cron: "0 */2 * * *"  # every 2 hours (for now)
  # TODO: switch to cron job
  push:
    branches:
      - try-artifacts-with-github-actions

jobs:
  download_data:
    name: Download and store data from IATI.cloud
    runs-on: ubuntu-latest
    steps:
      - shell: bash
        run: curl http://iati.cloud/search/activity?q=*:*&fl=id,iati_identifier,reporting_org_ref,reporting_org_type_code,reporting_org_type_name,reporting_org_secondary_reporter,reporting_org_narrative,title_narrative,title_narrative_lang,title_narrative_text,description_type,description_narrative,description_narrative_text,participating_org_ref,participating_org_type,participating_org_role,participating_org_narrative,participating_org_narrative_lang,participating_org_narrative_text,description_lang&wt=csv&rows=5000000 > test_data.csv
      - name: Upload
        uses: actions/upload-artifact@v1
        with:
          name: the_data_from_iati
          path: test_data.csv
  get_number_of_lines:
    name: Get Number of lines of data
    runs-on: ubuntu-latest
    steps:
      - name: Get the Artifact
        uses: actions/download-artifact@v1
        with:
          name: the_data_from_iati
      - shell: bash
        run: |
          ls .
          wc -l test_data.csv
